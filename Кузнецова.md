drop table if exists reading, comments cascade;

create table reading
(
   id int primary key,
   initial text,
   datas date,
   info text
);

create table comments
(
    id int primary key,
    state_id int references reading,
    info text,
    datas date
);

insert into reading(id, initial, datas, info)
values (1, 'Влияние гусениц на потепление', '2017-05-17', 'гусеницы милые'),
       (2, 'КПД жизни', '2019-09-03', 'успешный успех это успех'),
       (3, 'Топ 10 неожиданных сочетаний', '2020-02-19', '10 картошка с мороженым');
       
insert into comments(id, state_id, info, datas)
values (1, 1, 'я тоже задавался этим вопросом', '2020-09-06'),
	   (2, 1, 'весьма неожиданное заключение но где ссылка на документацию по исследованию', '2021-06-23'),
	   (3, 2, 'я придерживаюсь такой же логики', '2024-03-14'),
	   (4, 2, 'бред', '2023-12-12'),
	   (5, 3, '+++', '2020-02-04'),
	   (6, 3, 'не могу согласиться мне кажется это слишком стандартное сочетание вкусов', '2021-07-15');
	   
select * from reading;

select * from comments;

select
	read.id,
	read.initial,
	read.datas,
	read.info,
	coalesce(json_agg(json_build_object(
	'id', com.id, 'texts', com.info, 'date', com.datas))
	filter (where com.id is not null), '[]')
		as reading
from reading read
left join comments com on read.id = com.state_id
group by read.id	
	




drop table if exists tasks, comments cascade;

create table tasks
(
   id int primary key,
   task text,
   info text,
   level text
);

create table comments
(
    id int primary key,
    task_id int references tasks,
    info text,
    datas date
);

insert into tasks(id, task, info, level)
values  (1, 'убраться в доме по феншую', 'прочитать свод правил дома и правил уборки по феншую', 'hard'),
        (2, 'приготовить еду для приема гостей в резиенции', 'уточнить список гостей и пожеланий к блюдам относительно темы мероприятия и аллергии', 'medium'),
        (3, 'сделать уроки на месяц вперед', 'успеть сделать задание за неделю', 'medium');
        
       
insert into comments(id, task_id, info, datas)
values (1, 1, 'приняли работу все отлично', '2020-09-06'),
	   (2, 1, 'кровать стоит не по феншую ставлю 4-', '2021-06-23'),
	   (3, 2, 'повар знает свое дело персонал не подвел', '2024-03-14'),
	   (4, 2, 'в рыбе попались косточки и в еде был лук ужасный сервис', '2023-12-12'),
	   (5, 3, 'не готово', '2020-02-04'),
	   (6, 3, 'т.к. уроков почти не было задано ученик справился', '2021-07-15');
	   
select * from tasks;

select * from comments;

select
	t.id,
	t.task,
	t.info,
	t.level,
	coalesce(json_agg(json_build_object(
	'id', com.id, 'texts', com.info, 'date', com.datas))
	filter (where com.id is not null), '[]')
		as tasks
from tasks t
left join comments com on t.id = com.task_id
group by t.id	










drop table if exists study, groups cascade;

create table study
(
   id int primary key,
   title text,
   adress text
);

create table groups
(
    id int primary key,
    lern_id int references study,
    title text,
    programm text,
    year date
);

insert into study(id, title, adress)
values  (1, 'детский садик солнышко', 'мясницкая ул. 17'),
        (2, 'колледж сириус', 'олимпийский проспект 1'),
        (3, 'школа интернат для благородных дам', 'беговая ул.43');
        
       
insert into groups(id, lern_id, title, programm, year)
values (1, 1, 'одуванчики', 'детское дошкольное образование', '2020-09-06'),
	   (2, 1, 'озорные лютики', 'детское дошкольное образование', '2021-06-23'),
	   (3, 2, 'информационные системы и рпограммирование', 'К0709', '2024-03-14'),
	   (4, 2, 'кибербезопасность', 'К0609', '2023-12-12'),
	   (5, 3, '8 А', 'школьное образование', '2020-02-04'),
	   (6, 3, '11 Г', 'школьное образование', '2021-07-15');
	   
select * from study;

select * from groups;

select
	s.id,
	s.title,
	s.adress,
	coalesce(json_agg(json_build_object(
	'id', g.id, 'group name', g.title, 'programm', g.programm, 'year', g.year))
	filter (where g.id is not null), '[]')
		as study
from study s
left join groups g on s.id = g.lern_id
group by s.id	
